# Лабораторная работа №1 «Основы работы с EcoRouter»

## Тема: Настройка базовых функций маршрутизатора EcoRouter

## Цель работы:
Освоить основные команды настройки маршрутизатора EcoRouter, научиться настраивать интерфейсы, DHCP сервер и NAT трансляцию для обеспечения доступа в сеть Интернет.

## Схема сети:

![alt text](https://github.com/aleti000/mdk01.02/blob/main/pic/network.jpg)

## Таблица адресации:

  Устройство |  Интерфейс    |  ip-адрес
  -----------|---------------|-----------------
  |gateway     | ens19       |  DHCP             |
  |            | ens20       |  172.16.254.1/30  |
  |            | ens21       |  172.16.254.5/30  |
  |hq-rtr      | te0         |  172.16.254.2/30  |
  |            | te1         |  192.168.253.1/24 |
  |br-rtr      | te0         |  172.16.254.6/30  |
  |            | te1         |  192.168.252.1/24 |
  |hq-cli      | ens19       |  DHCP             |
  |br-srv      | ens19       |  DHCP static (192.168.252.2)      |

## Задачи лабораторной работы:

1. **Настройка IP-адресации** на всех устройствах сети
2. **Настройка DHCP сервера** для автоматической выдачи адресов клиентам в сети hq
3. **Настройка NAT трансляции** для обеспечения доступа в Интернет
4. **Проверка работоспособности** сети

## Ход выполнения работы:

### Шаг 1. Выполним настройку правой части сети: офиса BR

#### Шаг 1.1 Настроим gateway для части сети br:

Прежде всего зададим имя устройству в соответствии со схемой:

```bash
hostnamectl set-hostname gateway
```
Вначале настроим интерфейс доступа к интернету (ens19). Он не создан, создам его:

```bash
cd /etc/net/ifaces/
cp -R ens18/ ens19
systemctl restart network
```

Проверить получения ip-адреса на интерфейсе ens19:

```bash
ip -br -c a
```

Настроим интерфейс в сторону **br-rtr**:

```bash
cp -R ens18 ens21
cd ens21
echo TYPE=eth > options
echo BOOTPROTO=static >> options
echo 172.16.254.5/30 > ipv4address
systemctl restart network
```

Проверить получения ip-адреса на интерфейсе ens21:

```bash
ip -br -c a
```

### Шаг 2. Настройка конфигурации br-rtr

#### 2.1. Настройка hostname

```bash
enable
configure terminal
hostname br-rtr
```

#### 2.2. Создание интерфейсов

```bash
# Создание интерфейса для подключения к шлюзу 
interface gateway
ip address 172.16.254.6/30
no shutdown
description to gateway

# Создание интерфейса для локальной сети
interface br
ip address 192.168.252.1/24
no shutdown
description br network


#### 2.3. Настройка связи портов и интерфейсов через сервисные интерфейсы

```bash
# Настройка порта для локальной сети
port te0
service-instance wan
encapsulation untagged
connect ip interface gateway

# Настройка порта для внешней сети
port te1
service-instance lan
encapsulation untagged
connect ip interface br
```

#### 2.4 Проверка корректности настройки интерфейсов:

```bash
# вывести список интерфейсов
show ip interface brief
# проверить связь с gw
ping 172.16.254.5
```

### Шаг 3. Настройка DHCP сервера

#### 3.1. Создание пула адресов

```bash
# Создание пула IP-адресов для клиентов
ip pool BR 192.168.252.3-192.168.252.100
```

#### 3.2. Настройка DHCP сервера

```bash
# Создание DHCP сервера
dhcp-server 1

# Настройка статической записи
static ip 192.168.252.2
mask 24
gateway 192.168.252.1
dns 8.8.8.8
client-id mac #указать mac адрес клиентского хоста
exit # выйти из настройки статической выдачи

# Настройка пула адресов
pool br 1
mask 24
gateway 192.168.252.1
dns 8.8.8.8,8.8.4.4
lease 3600

# Привязка сервера к интерфейсу локальной сети
interface br
dhcp-server 1
```

### Шаг 4. Настройка NAT трансляции

#### 4.1. Настройка интерфейсов для NAT

```bash
# Настройка внутреннего интерфейса
interface br
ip nat inside

# Настройка внешнего интерфейса
interface gateway
ip nat outside
```

#### 4.2. Создание пула адресов для трансляции

```bash
# Создание пула внешних адресов
ip nat pool NAT 192.168.252.2-192.168.252.253
```

#### 4.3. Настройка динамической трансляции с перегрузкой

```bash
# Настройка PAT (Port Address Translation)
ip nat source dynamic inside-to-outside pool NAT overload interface gateway
```


### Шаг 5. Проверка конфигурации

Выполнить аналогичные действия для сети hq.

на gateway установить и настроить **iptables**


## Контрольные вопросы:

1. **Что такое сервисный интерфейс (service-instance) и зачем он нужен?**
2. **В чем разница между статической и динамической NAT трансляцией?**
3. **Как работает DHCP relay и когда он используется?**
4. **Что такое PAT и зачем он нужен?**
5. **Какие команды используются для диагностики сети в EcoRouter?**

## Критерии оценки:

Работа считается выполненной, если:

- [ ] Настроена IP-адресация на всех интерфейсах
- [ ] DHCP сервер корректно выдает адреса клиентам
- [ ] NAT трансляция работает в обе стороны
- [ ] Клиенты локальной сети могут пинговать внешние ресурсы
- [ ] Локальный сервер доступен из Интернета по проброшенным портам

## Дополнительные задания:

1. **Настройка статических записей в DHCP** для конкретных MAC-адресов
2. **Настройка ограничения скорости** для разных клиентов

## Примечания:

- Все изменения конфигурации сохраняйте командой `write memory`
- Перед внесением изменений создайте резервную копию конфигурации
- Используйте команду `show running-config` для просмотра текущей конфигурации
- Для получения справки по командам используйте `?` после части команды
