# Лабораторное занятие №2: Настройка OSPF на маршрутизаторах ecorouter

## Тема
Настройка протокола динамической маршрутизации OSPF с использованием GRE туннелей

## Цель
Изучить принципы настройки протокола OSPF, создание GRE туннелей и их интеграцию с протоколом маршрутизации

## Схема сети
Схема сети аналогична лабораторной работе №1 с добавлением GRE туннеля между маршрутизаторами hq-rtr и br-rtr

## Теоретические основы

### Протокол OSPF
OSPF (Open Shortest Path First) — протокол динамической маршрутизации, отслеживающий состояние каналов (Link-State) и использующий алгоритм Дейкстры для нахождения оптимального пути передачи данных.

**Основные операции OSPF:**
- Маршрутизаторы обмениваются Hello сообщениями для обнаружения соседей
- Происходит выбор Designated Router (DR) и Backup Designated Router (BDR) в широковещательных сетях
- Обмен топологической информацией через Link-State Advertisements (LSA)
- Построение карты сети и расчет кратчайших путей по алгоритму SPF

**Типы LSA:**
- Router LSA (Type 1) — информация о состоянии интерфейсов маршрутизатора
- Network LSA (Type 2) — информация о сегментах сети
- Summary LSA (Type 3) — межзональные маршруты
- ASBR Summary LSA (Type 4) — информация о пограничных маршрутизаторах AS
- External LSA (Type 5) — внешние маршруты

### GRE туннели
GRE (Generic Routing Encapsulation) — протокол туннелирования, инкапсулирующий пакеты одного протокола внутри другого. Позволяет передавать многоадресный трафик (мультикаст) и протоколы маршрутизации через IP-сеть.

**Особенности GRE:**
- Добавляет 4-байтовый заголовок к инкапсулируемому пакету
- Поддерживает транспортировку многоадресного трафика
- Требует настройки MTU из-за дополнительного заголовка
- Устанавливает DF-бит (Don't Fragment) по умолчанию

## Методические указания

### Требования к настройке
1. Настроить GRE туннель между маршрутизаторами hq-rtr и br-rtr
2. Настроить протокол OSPF в Area 0
3. Обеспечить соседские отношения между маршрутизаторами
4. Настроить передачу маршрута по умолчанию

### Правила настройки GRE
- MTU интерфейса туннеля должен быть меньше MTU физических интерфейсов
- IP-адреса туннельных интерфейсов должны быть в одной подсети
- Режим GRE должен быть одинаковым на обоих концах туннеля

### Правила настройки OSPF
- Router ID должен быть уникальным в домене маршрутизации
- Интерфейсы туннелей должны быть включены в процесс OSPF
- Пассивные интерфейсы не участвуют в обмене Hello сообщениями

## Ход работы

### Шаг 1. Настройка GRE туннеля на hq-rtr
```bash
enable
configure terminal
interface tunnel.0
 ip mtu 1400
 ip address 10.0.0.1/30
 ip tunnel 172.16.254.2 172.16.254.6 mode gre
 no shutdown
```

### Шаг 2. Настройка GRE туннеля на br-rtr

Настраивается студентом самостоятельно

### Шаг 3. Настройка OSPF на hq-rtr
```bash
enable
configure terminal
router ospf 1
 network 192.168.253.0 0.0.0.255 area 0
 network 10.0.0.0 0.0.0.3 area 0
 passive-interface default
 no passive-interface tunnel.0
```

### Шаг 4. Настройка OSPF на br-rtr

Настраивается студентом самостоятельно

### Шаг 5. Настройка передачи маршрута по умолчанию через OSPF

Настраивается студентом самостоятельно

### Шаг 6. Опциональные настройки

#### 6.1. Настройка аутентификации OSPF

Настраивается студентом самостоятельно

#### 6.2. Настройка интерфейсов как point-to-point

Настраивается студентом самостоятельно

## Проверка корректности настройки

### Команды для диагностики OSPF
```bash
# Проверка соседских отношений
show ip ospf neighbor

# Проверка таблицы маршрутизации
show ip route

# Проверка OSPF маршрутов
show ip route ospf

# Проверка состояния интерфейсов
show ip ospf interface

# Проверка базы данных OSPF
show ip ospf database
```

### Команды для диагностики GRE туннелей
```bash
# Проверка состояния туннельного интерфейса
show interface tunnel.0

# Проверка таблицы ARP
show arp
```

## Критерии выполнения работы

Работа считается выполненной при соблюдении следующих условий:

1. **Установлен GRE туннель** между hq-rtr и br-rtr
2. **Настроены соседские отношения OSPF** между маршрутизаторами
3. **Таблица маршрутизации содержит** все подсети сети (192.168.252.0/24, 192.168.253.0/24, 10.0.0.0/30)
4. **Настроена передача маршрута по умолчанию** через OSPF
5. **Туннельный интерфейс** находится в состоянии UP/UP

### Проверка соседских отношений
```bash
show ip ospf neighbor
```
Должны отображаться оба маршрутизатора в состоянии FULL.

### Проверка таблицы маршрутизации
```bash
show ip route ospf
```
Таблица должна содержать маршруты до всех подсетей с корректными next-hop адресами.

### Проверка туннельного интерфейса
```bash
show interface tunnel.0
```
Интерфейс должен быть в состоянии "up, line protocol is up".

## Возможные проблемы и их решения

### Проблема: Туннель не устанавливается
**Решение:**
- Проверить IP адреса источников и назначений туннеля
- Убедиться, что MTU интерфейсов достаточен
- Проверить маршрутизацию до IP адресов туннеля

### Проблема: OSPF не устанавливает соседство
**Решение:**
- Проверить, что tunnel.0 не в passive-interface
- Убедиться, что network команды корректно включают подсети
- Проверить таймеры OSPF (hello-interval, dead-interval)

### Проблема: Маршруты не появляются в таблице
**Решение:**
- Проверить настройки redistribution
- Убедиться, что интерфейсы включены (no shutdown)
- Проверить фильтры маршрутизации
