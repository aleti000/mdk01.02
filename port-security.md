# Лекция: Port-Security на оборудовании Cisco

---

## Введение в Port-Security

**Что такое Port-Security?**  
Port-Security — это функция Cisco, которая позволяет контролировать доступ к портам коммутатора, ограничивая количество и типы MAC-адресов, разрешённых для подключения. Это помогает предотвратить несанкционированный доступ, например, в результате атак типа **MAC flooding** или **MAC spoofing**.

**Цели Port-Security:**  
1. Ограничение количества MAC-адресов на порту.  
2. Фиксация конкретных MAC-адресов для разрешённых устройств.  
3. Защита от неавторизованных устройств.  

**Преимущества:**  
- Защита от атак на уровень данных (Layer 2).  
- Упрощение контроля доступа в сети.  
- Уменьшение риска кражи MAC-адресов.  

---

## Основные понятия

### 1. **Настройка Port-Security**
Для включения Port-Security на порту выполните команды:  
```bash
interface FastEthernet 0/1  
 switchport mode access  
 switchport port-security  
```

#### Ключевые команды:
- **`switchport port-security maximum <число>`**  
  Ограничивает максимальное количество MAC-адресов на порту.  
  Пример: `switchport port-security maximum 2`

- **`switchport port-security mac-address <MAC>`**  
  Добавляет статический MAC-адрес в разрешённый список.  
  Пример: `switchport port-security mac-address 0011.2222.3333`

- **`switchport port-security aging time <время>`**  
  Устанавливает время "старения" динамических MAC-адресов (по умолчанию 1 день).

- **`switchport port-security violation <режим>`**  
  Определяет реакцию на нарушение политик:  
  - **`protect`**: Блокирует трафик от нарушителя, но не закрывает порт.  
  - **`restrict`**: Логирует событие и снижает скорость порта (или не блокирует).  
  - **`shutdown`**: Закрывает порт на заданный интервал (например, 10 минут).  

- **`switchport port-security sticky`**  
  Включает "sticky learning" — автоматически сохраняет MAC-адреса устройств в конфигурации после перезагрузки.

---

### 2. **Режимы работы Port-Security**
| Режим          | Результат нарушения                                                                 |
|----------------|------------------------------------------------------------------------------------|
| **protect**    | Блокирует трафик от нарушителя, но не закрывает порт.                              |
| **restrict**   | Логирует событие, уведомляет SNMP и может ограничивать скорость.                   |
| **shutdown**   | Закрывает порт (настраивается через `shutdown` и `recovery`).                      |

---

## Пример конфигурации

**Сценарий:** На порту Fa0/1 разрешено два MAC-адреса (статический и динамический).  

```bash
interface FastEthernet0/1  
 switchport mode access  
 switchport port-security  
 switchport port-security maximum 2  
 switchport port-security mac-address 0011.2222.3333  
 switchport port-security violation restrict  
 switchport port-security aging time 2  
 switchport port-security sticky  
```

**Объяснение:**  
- `maximum 2` — допускается два MAC.  
- `mac-address 0011.2222.3333` — фиксированный MAC.  
- `violation restrict` — нарушение приведёт к логированию и снижению скорости.  
- `aging time 2` — динамические MAC удаляются через 2 часа.  
- `sticky` — MAC-адреса сохраняются в конфигурации.  

---

## Практические советы

1. **Используйте `sticky learning`**  
   Это упрощает управление MAC-адресами, так как они автоматически добавляются в разрешённый список.  

2. **Тестирование**  
   После настройки проверьте работу порта:  
   ```bash
   show port-security interface FastEthernet0/1  
   ```

3. **Исключения**  
   Port-Security не применяется к:  
   - Трафику с MAC-адресами `0000.0000.0000` или `FFFFFFFF.FFFFFF`.  
   - Трафику trunk-портов.  

---

## Ограничения и потенциальные проблемы

1. **Динамические устройства**  
   Устройства с часто меняющимися MAC-адресами (например, виртуальные машины) могут требовать перенастройки.  

2. **Атаки с известными MAC-адресами**  
   Port-Security не защищает от подмены MAC, если злоумышленник знает разрешённый адрес.  

3. **Закрытые порты**  
   Режим `shutdown` может привести к недоступности порта. Убедитесь, что есть возможность его восстановить.  

---

## Сценарии использования

1. **Офисные сети**  
   На портах, где подключены стационарные компьютеры, можно фиксировать MAC-адреса.  

2. **Гостевые порты**  
   Ограничить доступ до одного MAC-адреса:  
   ```bash
   switchport port-security maximum 1  
   ```

3. **Сети с IoT-устройствами**  
   Устройства с фиксированными MAC (например, IP-камеры) можно добавить в разрешённый список.  

---

## Часто задаваемые вопросы (FAQ)

**Q:** Как обновить MAC-адрес при замене оборудования?  
**A:** Используйте `switchport port-security mac-address` для добавления нового MAC.  

**Q:** Как восстановить доступ, если порт закрыт?  
**A:** Перезагрузите коммутатор или выполните:  
```bash
clear port-security interface FastEthernet0/1  
```  

**Q:** Можно ли использовать Port-Security на trunk-портах?  
**A:** Нет, Port-Security работает только на портах доступа (`access mode`).  

---

## Заключение

Port-Security — мощный инструмент для защиты сетевых портов от несанкционированного доступа. Его эффективность зависит от правильной настройки и учёта особенностей сети. Всегда проверяйте конфигурацию и следите за логами для своевременного выявления нарушений.  

**Дополнительные ресурсы:**  
- Документация Cisco: [Cisco Port Security](https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst2960/software/release/12-2_55_se/configuration_guide/b_12255_se_2960_config/swportsec.html)  
- Лабораторные задания: Настройте Port-Security в Packet Tracer или Cisco Packet Tracer.  

--- 

**Вопрос для самопроверки:**  
Какие три основных команды необходимы для включения Port-Security на порту?
